# This file is part of the dune-gdt project:
#   https://github.com/dune-community/dune-gdt
# Copyright 2010-2016 dune-gdt developers and contributors. All rights reserved.
# License: BSD 2-Clause License (http://opensource.org/licenses/BSD-2-Clause)
# Authors:
#   Felix Schindler (2016)

# THIS FILE IS AUTOGENERATED -- DO NOT EDIT #


sudo: required
dist: trusty
language: generic
services: docker

script:
    - export IMAGE="renemilk/dune-testing:${DOCKER_TAG}"
    - docker pull ${IMAGE}
    - travis_wait 50 docker run -e TESTS=${TESTS} -v ${TRAVIS_BUILD_DIR}:/root/src/dune-gdt ${IMAGE} /root/src/dune-gdt/.travis.run_tests.bash
    - ${SUPERDIR}/.travis/init_sshkey.sh ${encrypted_95fb78800815_key} ${encrypted_95fb78800815_iv} keys/dune-community/dune-gdt-testlogs
    - if [[ "x${TESTS}" != "xheadercheck" ]]; then travis_retry ${SUPERDIR}/scripts/bash/travis_upload_test_logs.bash ${SUPERDIR}/${MY_MODULE}/test_dir/; fi

# runs independent of 'script' failure/success
after_script:
    - |
     if [ "x${CLANG_FORMAT}" != "x" ] ; then
        git config --global hooks.clangformat ${CLANG_FORMAT}
        PYTHONPATH=${SUPERDIR}/scripts/python/ python3 -c "import travis_report as tp; tp.clang_format_status("${TRAVIS_BUILD_DIR}")"
     fi
    - |
      if [[ $TRAVIS_JOB_NUMBER == *.1 ]] ; then
        ${SRC_DCTRL} ${BLD} --only=${MY_MODULE} make doc
        ${SUPERDIR}/.travis/init_sshkey.sh ${encrypted_95fb78800815_key} ${encrypted_95fb78800815_iv} keys/dune-community/dune-community.github.io
        # ${SUPERDIR}/.travis/deploy_docs.sh ${MY_MODULE} ${DUNE_BUILD_DIR}
      fi

notifications:
  email:
    on_success: change
    on_failure: change
    on_start: never
  webhooks:
    urls:
      - https://buildtimetrend.herokuapp.com/travis
      - https://webhooks.gitter.im/e/2a38e80d2722df87f945

branches:
  except:
    - gh-pages

env:
  global:
    - SUPERDIR=${HOME}/src
    - PATH=${SUPERDIR}/local/bin:$PATH
    - LD_LIBRARY_PATH=${SUPERDIR}/local/lib64:${SUPERDIR}/local/lib:$LD_LIBRARY_PATH
    - PKG_CONFIG_PATH=${SUPERDIR}/local/lib64/pkgconfig:${SUPERDIR}/local/lib/pkgconfig:${SUPERDIR}/local/share/pkgconfig:$PKG_CONFIG_PATH
    - MY_MODULE=dune-gdt
    - DUNE_BUILD_DIR=${HOME}/dune_build/
    - INSTALL_DIR=$HOME/dune
    - CTEST_OUTPUT_ON_FAILURE=1
    - DCTL_ARGS="--builddir=${DUNE_BUILD_DIR} --use-cmake"
    - DBG="${DCTL_ARGS} --opts=config.opts/travis.ninja"
    - BLD=${DBG}

matrix:
  include:
#   gcc 5
    - env: DOCKER_TAG=gcc-5 TESTS=0
    - env: DOCKER_TAG=gcc-5 TESTS=1
    - env: DOCKER_TAG=gcc-5 TESTS=2
    - env: DOCKER_TAG=gcc-5 TESTS=3
    - env: DOCKER_TAG=gcc-5 TESTS=4
    - env: DOCKER_TAG=gcc-5 TESTS=5
    - env: DOCKER_TAG=gcc-5 TESTS=6
    - env: DOCKER_TAG=gcc-5 TESTS=7
    - env: DOCKER_TAG=gcc-5 TESTS=8
    - env: DOCKER_TAG=gcc-5 TESTS=9
    - env: DOCKER_TAG=gcc-5 TESTS=10
    - env: DOCKER_TAG=gcc-5 TESTS=11
    - env: DOCKER_TAG=gcc-5 TESTS=12
    - env: DOCKER_TAG=gcc-5 TESTS=13
    - env: DOCKER_TAG=gcc-5 TESTS=14
    - env: DOCKER_TAG=gcc-5 TESTS=15
    - env: DOCKER_TAG=gcc-5 TESTS=16
    - env: DOCKER_TAG=gcc-5 TESTS=17
    - env: DOCKER_TAG=gcc-5 TESTS=18
    - env: DOCKER_TAG=gcc-5 TESTS=19
    - env: DOCKER_TAG=gcc-5 TESTS=20
    - env: DOCKER_TAG=gcc-5 TESTS=21
    - env: DOCKER_TAG=gcc-5 TESTS=22
    - env: DOCKER_TAG=gcc-5 TESTS=23
    - env: DOCKER_TAG=gcc-5 TESTS=headercheck CLANG_FORMAT='/usr/bin/clang-format-3.8'
#   clang 3.8
    #- env: DOCKER_TAG=clang-3.8 TESTS=0
    #- env: DOCKER_TAG=clang-3.8 TESTS=1
    #- env: DOCKER_TAG=clang-3.8 TESTS=2
    #- env: DOCKER_TAG=clang-3.8 TESTS=3
    #- env: DOCKER_TAG=clang-3.8 TESTS=4
    #- env: DOCKER_TAG=clang-3.8 TESTS=5
    #- env: DOCKER_TAG=clang-3.8 TESTS=6
    #- env: DOCKER_TAG=clang-3.8 TESTS=7
    #- env: DOCKER_TAG=clang-3.8 TESTS=8
    #- env: DOCKER_TAG=clang-3.8 TESTS=9
    #- env: DOCKER_TAG=clang-3.8 TESTS=10
    #- env: DOCKER_TAG=clang-3.8 TESTS=11
    #- env: DOCKER_TAG=clang-3.8 TESTS=12
    #- env: DOCKER_TAG=clang-3.8 TESTS=13
    #- env: DOCKER_TAG=clang-3.8 TESTS=14
    #- env: DOCKER_TAG=clang-3.8 TESTS=15
    #- env: DOCKER_TAG=clang-3.8 TESTS=16
    #- env: DOCKER_TAG=clang-3.8 TESTS=17
    #- env: DOCKER_TAG=clang-3.8 TESTS=18
    #- env: DOCKER_TAG=clang-3.8 TESTS=19
    #- env: DOCKER_TAG=clang-3.8 TESTS=20
    #- env: DOCKER_TAG=clang-3.8 TESTS=21
    #- env: DOCKER_TAG=clang-3.8 TESTS=22
    #- env: DOCKER_TAG=clang-3.8 TESTS=23
    #- env: DOCKER_TAG=clang-3.8 TESTS=headercheck CLANG_FORMAT='/usr/bin/clang-format-3.8'

# THIS FILE IS AUTOGENERATED -- DO NOT EDIT #